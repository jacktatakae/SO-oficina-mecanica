<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîß Diagn√≥stico de Arquivos - VRS</title>
    
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .diagnostic-container {
            background: white;
            border-radius: 20px;
            padding: 2rem;
            margin: 2rem auto;
            max-width: 1000px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }

        .test-item {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 5px solid #6c757d;
            transition: all 0.3s ease;
        }

        .test-item.loading {
            border-left-color: #ffc107;
            background: #fff3cd;
        }

        .test-item.success {
            border-left-color: #28a745;
            background: #d4edda;
        }

        .test-item.error {
            border-left-color: #dc3545;
            background: #f8d7da;
        }

        .file-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1rem;
            margin: 1rem 0;
        }

        .progress-bar {
            background: #e9ecef;
            border-radius: 10px;
            height: 25px;
            overflow: hidden;
            margin: 1rem 0;
        }

        .progress-fill {
            background: linear-gradient(90deg, #28a745, #20c997);
            height: 100%;
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="diagnostic-container">
            <div class="text-center mb-4">
                <h1><i class="fas fa-tools me-2 text-primary"></i>Diagn√≥stico de Arquivos VRS</h1>
                <p class="text-muted">Verifica√ß√£o completa de depend√™ncias e integridade do sistema</p>
                
                <div class="progress-bar">
                    <div class="progress-fill" id="progressBar" style="width: 0%;">0%</div>
                </div>
            </div>

            <!-- Status Geral -->
            <div class="alert alert-info" id="generalStatus">
                <i class="fas fa-info-circle me-2"></i>
                <strong>Iniciando diagn√≥stico...</strong>
                <div id="statusDetails">Preparando verifica√ß√µes...</div>
            </div>

            <!-- Se√ß√£o: P√°ginas HTML -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5><i class="fas fa-file-alt me-2"></i>P√°ginas HTML</h5>
                </div>
                <div class="card-body">
                    <div class="file-grid" id="htmlFiles"></div>
                </div>
            </div>

            <!-- Se√ß√£o: Arquivos JavaScript -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5><i class="fab fa-js-square me-2"></i>Arquivos JavaScript</h5>
                </div>
                <div class="card-body">
                    <div class="file-grid" id="jsFiles"></div>
                </div>
            </div>

            <!-- Se√ß√£o: Arquivos CSS -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5><i class="fas fa-paint-brush me-2"></i>Arquivos CSS</h5>
                </div>
                <div class="card-body">
                    <div class="file-grid" id="cssFiles"></div>
                </div>
            </div>

            <!-- Se√ß√£o: Outros Arquivos -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5><i class="fas fa-file me-2"></i>Outros Arquivos</h5>
                </div>
                <div class="card-body">
                    <div class="file-grid" id="otherFiles"></div>
                </div>
            </div>

            <!-- Resultado Final -->
            <div class="alert" id="finalResult" style="display: none;">
                <h4 id="resultTitle"></h4>
                <div id="resultMessage"></div>
                <div id="resultActions" class="mt-3"></div>
            </div>

            <!-- Bot√µes de A√ß√£o -->
            <div class="text-center">
                <button class="btn btn-primary btn-lg me-2" onclick="runDiagnostic()">
                    <i class="fas fa-play me-2"></i>Executar Diagn√≥stico
                </button>
                <button class="btn btn-success btn-lg me-2" onclick="fixCommonIssues()">
                    <i class="fas fa-wrench me-2"></i>Corrigir Problemas
                </button>
                <button class="btn btn-info btn-lg" onclick="window.location.href='inventario-rapido.html'">
                    <i class="fas fa-home me-2"></i>Voltar ao VRS
                </button>
            </div>
        </div>
    </div>

    <script>
        // Lista de arquivos para verificar
        const FILES_TO_CHECK = {
            html: [
                'index.html',
                'inventario-rapido.html',
                'scanner-visual.html',
                'github-sync-mobile.html',
                'instalar-app.html',
                'teste-pwa.html',
                'gerenciador-backup.html',
                'cadastro-cliente.html',
                'central-sistemas.html',
                'gerenciador-clientes.html'
            ],
            js: [
                'auto-backup-system.js',
                'github-sync.js',
                'ia-visual-radiadores.js',
                'python-bridge.js',
                'catalogo-manager.js',
                'config-contatos.js',
                'sw.js'
            ],
            css: [
                'styles.css',
                'mobile-responsive.css'
            ],
            other: [
                'manifest.json',
                'sw.js'
            ]
        };

        let diagnosticResults = {};
        let totalFiles = 0;
        let checkedFiles = 0;

        // Calcular total de arquivos
        for (const category in FILES_TO_CHECK) {
            totalFiles += FILES_TO_CHECK[category].length;
        }

        async function runDiagnostic() {
            diagnosticResults = {};
            checkedFiles = 0;
            
            updateProgress(0);
            updateStatus('Iniciando verifica√ß√£o de arquivos...', 'info');
            
            // Verificar cada categoria
            for (const [category, files] of Object.entries(FILES_TO_CHECK)) {
                await checkFileCategory(category, files);
            }
            
            // Mostrar resultado final
            showFinalResults();
        }

        async function checkFileCategory(category, files) {
            const container = document.getElementById(category + 'Files');
            container.innerHTML = '';
            
            for (const file of files) {
                const testItem = createTestItem(file);
                container.appendChild(testItem);
                
                const result = await checkFile(file);
                updateTestItem(testItem, result);
                
                diagnosticResults[file] = result;
                checkedFiles++;
                updateProgress((checkedFiles / totalFiles) * 100);
            }
        }

        async function checkFile(filename) {
            try {
                console.log('üîç Verificando arquivo:', filename);
                
                const response = await fetch(filename, { 
                    method: 'HEAD',
                    cache: 'no-cache'
                });
                
                if (response.ok) {
                    return {
                        status: 'success',
                        message: `‚úÖ Encontrado (${Math.round(response.headers.get('content-length')/1024) || '?'}KB)`,
                        details: `Status: ${response.status} | Tipo: ${response.headers.get('content-type') || 'Desconhecido'}`
                    };
                } else {
                    return {
                        status: 'error',
                        message: `‚ùå Erro HTTP ${response.status}`,
                        details: `N√£o foi poss√≠vel carregar o arquivo`
                    };
                }
            } catch (error) {
                return {
                    status: 'error',
                    message: `‚ùå N√£o encontrado`,
                    details: `Erro: ${error.message}`
                };
            }
        }

        function createTestItem(filename) {
            const item = document.createElement('div');
            item.className = 'test-item loading';
            item.innerHTML = `
                <div class="d-flex justify-content-between align-items-center">
                    <strong>${filename}</strong>
                    <span class="status-icon"><i class="fas fa-spinner fa-spin"></i></span>
                </div>
                <div class="status-message">Verificando...</div>
                <div class="status-details" style="font-size: 0.8rem; color: #666;"></div>
            `;
            return item;
        }

        function updateTestItem(item, result) {
            item.className = `test-item ${result.status}`;
            
            const statusIcon = item.querySelector('.status-icon');
            const statusMessage = item.querySelector('.status-message');
            const statusDetails = item.querySelector('.status-details');
            
            if (result.status === 'success') {
                statusIcon.innerHTML = '<i class="fas fa-check-circle text-success"></i>';
            } else {
                statusIcon.innerHTML = '<i class="fas fa-exclamation-triangle text-danger"></i>';
            }
            
            statusMessage.innerHTML = result.message;
            statusDetails.innerHTML = result.details;
        }

        function updateProgress(percentage) {
            const progressBar = document.getElementById('progressBar');
            progressBar.style.width = `${percentage}%`;
            progressBar.textContent = `${Math.round(percentage)}%`;
        }

        function updateStatus(message, type = 'info') {
            const statusDiv = document.getElementById('generalStatus');
            const statusDetails = document.getElementById('statusDetails');
            
            statusDiv.className = `alert alert-${type}`;
            statusDetails.innerHTML = message;
        }

        function showFinalResults() {
            const resultDiv = document.getElementById('finalResult');
            const titleElement = document.getElementById('resultTitle');
            const messageElement = document.getElementById('resultMessage');
            const actionsElement = document.getElementById('resultActions');
            
            let successCount = 0;
            let errorCount = 0;
            let missingFiles = [];
            
            for (const [file, result] of Object.entries(diagnosticResults)) {
                if (result.status === 'success') {
                    successCount++;
                } else {
                    errorCount++;
                    missingFiles.push(file);
                }
            }
            
            if (errorCount === 0) {
                resultDiv.className = 'alert alert-success';
                titleElement.innerHTML = '<i class="fas fa-check-circle me-2"></i>Diagn√≥stico Completo - Tudo OK!';
                messageElement.innerHTML = `
                    üéâ Todos os ${successCount} arquivos foram encontrados com sucesso!<br>
                    ‚úÖ O sistema VRS est√° funcionando corretamente.<br>
                    ‚úÖ Navega√ß√£o entre p√°ginas deve funcionar sem problemas.
                `;
                actionsElement.innerHTML = `
                    <button class="btn btn-primary" onclick="window.location.href='inventario-rapido.html'">
                        <i class="fas fa-rocket me-2"></i>Usar VRS Agora
                    </button>
                `;
            } else {
                resultDiv.className = 'alert alert-warning';
                titleElement.innerHTML = '<i class="fas fa-exclamation-triangle me-2"></i>Problemas Encontrados';
                messageElement.innerHTML = `
                    ‚ö†Ô∏è ${errorCount} arquivo(s) n√£o encontrado(s) de ${totalFiles} verificados.<br>
                    ‚úÖ ${successCount} arquivo(s) est√£o funcionando corretamente.<br><br>
                    <strong>Arquivos com problema:</strong><br>
                    ${missingFiles.map(file => `‚ùå ${file}`).join('<br>')}
                `;
                actionsElement.innerHTML = `
                    <button class="btn btn-warning me-2" onclick="fixCommonIssues()">
                        <i class="fas fa-wrench me-2"></i>Tentar Corrigir
                    </button>
                    <button class="btn btn-info me-2" onclick="showWorkarounds()">
                        <i class="fas fa-lightbulb me-2"></i>Ver Solu√ß√µes
                    </button>
                    <button class="btn btn-primary" onclick="window.location.href='inventario-rapido.html'">
                        <i class="fas fa-play me-2"></i>Usar Mesmo Assim
                    </button>
                `;
            }
            
            resultDiv.style.display = 'block';
            updateStatus(`Diagn√≥stico conclu√≠do: ${successCount} OK, ${errorCount} problemas`, 
                        errorCount === 0 ? 'success' : 'warning');
        }

        function fixCommonIssues() {
            alert('üîß Corre√ß√£o Autom√°tica\n\nAs seguintes a√ß√µes ser√£o tentadas:\n\n1. Limpar cache do navegador\n2. Recarregar service worker\n3. For√ßar atualiza√ß√£o\n\nIsso pode resolver problemas de cache e arquivos ausentes.');
            
            // Limpar caches
            if ('caches' in window) {
                caches.keys().then(cacheNames => {
                    return Promise.all(
                        cacheNames.map(cacheName => caches.delete(cacheName))
                    );
                }).then(() => {
                    console.log('‚úÖ Caches limpos');
                });
            }
            
            // Recarregar service worker
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.getRegistrations().then(registrations => {
                    registrations.forEach(registration => {
                        registration.update();
                    });
                });
            }
            
            // Recarregar p√°gina ap√≥s breve delay
            setTimeout(() => {
                location.reload(true);
            }, 2000);
        }

        function showWorkarounds() {
            const workarounds = `
üõ†Ô∏è SOLU√á√ïES PARA PROBLEMAS COMUNS:

1. üì± NAVEGA√á√ÉO NO CELULAR:
   ‚Ä¢ Use o bot√£o "Voltar" do navegador
   ‚Ä¢ Evite links quebrados
   ‚Ä¢ Instale como PWA para melhor experi√™ncia

2. üîÑ ARQUIVOS AUSENTES:
   ‚Ä¢ Recarregue a p√°gina (F5)
   ‚Ä¢ Limpe cache do navegador
   ‚Ä¢ Verifique conex√£o com internet

3. üìÇ PROBLEMAS DE CAMINHO:
   ‚Ä¢ Certifique-se que todos arquivos est√£o na mesma pasta
   ‚Ä¢ Verifique se nomes est√£o corretos
   ‚Ä¢ Use caminhos relativos (./)

4. üåê PROBLEMAS DE SERVIDOR:
   ‚Ä¢ Use servidor HTTP local
   ‚Ä¢ Evite abrir arquivos diretamente (file://)
   ‚Ä¢ Configure servidor Python ou Node.js

5. üì± INSTALA√á√ÉO PWA:
   ‚Ä¢ Acesse via HTTPS
   ‚Ä¢ Use navegador compat√≠vel
   ‚Ä¢ Aguarde manifesto carregar
            `;
            
            alert(workarounds);
        }

        // Executar diagn√≥stico automaticamente ao carregar
        window.addEventListener('load', () => {
            setTimeout(runDiagnostic, 1000);
        });
    </script>
</body>
</html>
