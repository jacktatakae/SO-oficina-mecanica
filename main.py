#!/usr/bin/env python3
"""
Sistema Completo de Gest√£o de Pe√ßas Automotivas
Desenvolvido para extrair informa√ß√µes da internet e gerenciar clientes
"""

import os
import sys
import sqlite3
import shutil
from sistema_automotivo import SistemaAutomotivo
from relatorios import RelatoriosAvancados
from importador import ImportadorDados

class MenuPrincipal:
    def __init__(self):
        self.sistema = SistemaAutomotivo()
        self.relatorios = RelatoriosAvancados()
        self.importador = ImportadorDados()
    
    def mostrar_banner(self):
        """Mostra o banner do sistema"""
        print("""
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë           üöó SISTEMA DE PE√áAS AUTOMOTIVAS üîß                ‚ïë
‚ïë                                                              ‚ïë
‚ïë  Sistema completo para gest√£o de pe√ßas e clientes           ‚ïë
‚ïë  Com extra√ß√£o autom√°tica de dados da internet               ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
        """)
    
    def menu_principal(self):
        """Menu principal do sistema"""
        while True:
            self.mostrar_banner()
            print("\nüìã MENU PRINCIPAL")
            print("="*30)
            print("1.  üåê Extrair pe√ßas da internet")
            print("2.  üë§ Gerenciar clientes")
            print("3.  üîç Consultar pe√ßas")
            print("4.  üìä Relat√≥rios e an√°lises")
            print("5.  üì• Importar/Exportar dados")
            print("6.  ‚öôÔ∏è  Configura√ß√µes")
            print("0.  üö™ Sair")
            
            opcao = input("\n‚û§ Escolha uma op√ß√£o: ").strip()
            
            if opcao == '1':
                self.menu_extracao()
            elif opcao == '2':
                self.menu_clientes()
            elif opcao == '3':
                self.menu_consultas()
            elif opcao == '4':
                self.menu_relatorios()
            elif opcao == '5':
                self.menu_importacao()
            elif opcao == '6':
                self.menu_configuracoes()
            elif opcao == '0':
                print("\nüëã Obrigado por usar o Sistema de Pe√ßas Automotivas!")
                break
            else:
                input("‚ùå Op√ß√£o inv√°lida! Pressione Enter para continuar...")
    
    def menu_extracao(self):
        """Menu para extra√ß√£o de dados da internet"""
        while True:
            print("\nüåê EXTRA√á√ÉO DE DADOS DA INTERNET")
            print("="*35)
            print("1. Atualizar todas as categorias")
            print("2. Extrair pe√ßas espec√≠ficas")
            print("3. Ver √∫ltima atualiza√ß√£o")
            print("0. Voltar ao menu principal")
            
            opcao = input("\n‚û§ Escolha uma op√ß√£o: ").strip()
            
            if opcao == '1':
                print("\nüîÑ Iniciando extra√ß√£o completa...")
                print("‚ö†Ô∏è  Este processo pode demorar alguns minutos...")
                confirmacao = input("Deseja continuar? (s/n): ").lower()
                
                if confirmacao == 's':
                    try:
                        self.sistema.atualizar_pecas_internet()
                        print("‚úÖ Extra√ß√£o conclu√≠da com sucesso!")
                    except Exception as e:
                        print(f"‚ùå Erro durante a extra√ß√£o: {e}")
                
                input("\nPressione Enter para continuar...")
            
            elif opcao == '2':
                termo = input("Digite o termo de busca (ex: 'vela igni√ß√£o'): ").strip()
                if termo:
                    print(f"\nüîç Buscando por: {termo}")
                    try:
                        # Buscar usando as novas fontes
                        pecas_encontradas = []
                        
                        # Buscar no banco de dados local primeiro
                        todas_pecas = self.sistema.db.buscar_pecas()
                        if not todas_pecas.empty:
                            pecas_filtradas = todas_pecas[
                                todas_pecas['nome'].str.contains(termo, case=False, na=False) |
                                todas_pecas['descricao'].str.contains(termo, case=False, na=False)
                            ]
                            
                            if not pecas_filtradas.empty:
                                print(f"\nÔøΩ Encontradas {len(pecas_filtradas)} pe√ßas no banco local:")
                                for _, peca in pecas_filtradas.head(5).iterrows():
                                    preco_str = f"R$ {peca['preco']:.2f}" if peca['preco'] > 0 else "Sob consulta"
                                    print(f"  ‚Ä¢ {peca['nome']} - {preco_str} ({peca['fabricante']})")
                            else:
                                print("‚ùå Nenhuma pe√ßa encontrada no banco local")
                        
                        # Buscar online se necess√°rio
                        buscar_online = input("\nDeseja buscar online tamb√©m? (s/n): ").lower()
                        if buscar_online == 's':
                            print("üåê Buscando online...")
                            
                            # Usar as novas fontes
                            pecas_auto = self.sistema.scraper.extrair_pecas_autopecas(termo, 3)
                            pecas_nakata = self.sistema.scraper.extrair_pecas_nakata(termo, 2)
                            
                            total_online = len(pecas_auto) + len(pecas_nakata)
                            if total_online > 0:
                                print(f"\nüéØ Encontradas {total_online} pe√ßas online:")
                                
                                for peca in pecas_auto:
                                    print(f"  ‚Ä¢ {peca.nome} - R$ {peca.preco:.2f} ({peca.fabricante})")
                                
                                for peca in pecas_nakata:
                                    print(f"  ‚Ä¢ {peca.nome} - R$ {peca.preco:.2f} ({peca.fabricante})")
                            else:
                                print("‚ùå Nenhuma pe√ßa encontrada online")
                        
                    except Exception as e:
                        print(f"‚ùå Erro na busca: {e}")
                
                input("\nPressione Enter para continuar...")
            
            elif opcao == '3':
                # Mostrar estat√≠sticas da √∫ltima atualiza√ß√£o
                stats = self.relatorios.estatisticas_gerais()
                print(f"\nüìä Total de pe√ßas no banco: {stats.get('total_pecas', 0)}")
                print(f"üìä Categorias ativas: {stats.get('categorias_ativas', 0)}")
                
                input("\nPressione Enter para continuar...")
            
            elif opcao == '0':
                break
            else:
                input("‚ùå Op√ß√£o inv√°lida! Pressione Enter para continuar...")
    
    def menu_clientes(self):
        """Menu para gerenciamento de clientes"""
        while True:
            print("\nüë§ GERENCIAMENTO DE CLIENTES")
            print("="*30)
            print("1. Cadastrar novo cliente")
            print("2. Buscar cliente")
            print("3. Listar todos os clientes")
            print("4. Clientes por marca de carro")
            print("0. Voltar ao menu principal")
            
            opcao = input("\n‚û§ Escolha uma op√ß√£o: ").strip()
            
            if opcao == '1':
                self.cadastrar_cliente()
            elif opcao == '2':
                self.buscar_cliente()
            elif opcao == '3':
                self.listar_clientes()
            elif opcao == '4':
                self.clientes_por_marca()
            elif opcao == '0':
                break
            else:
                input("‚ùå Op√ß√£o inv√°lida! Pressione Enter para continuar...")
    
    def cadastrar_cliente(self):
        """Cadastra um novo cliente"""
        print("\n‚ûï CADASTRAR NOVO CLIENTE")
        print("-" * 25)
        
        try:
            nome = input("Nome completo: ").strip()
            endereco = input("Endere√ßo: ").strip()
            telefone = input("Telefone: ").strip()
            email = input("Email: ").strip()
            marca = input("Marca do carro: ").strip()
            modelo = input("Modelo do carro: ").strip()
            ano = int(input("Ano do carro: ").strip())
            
            if nome and endereco and telefone:
                resultado = self.sistema.cadastrar_cliente(
                    nome, endereco, telefone, email, marca, modelo, ano
                )
                print(f"\n‚úÖ {resultado}")
            else:
                print("‚ùå Nome, endere√ßo e telefone s√£o obrigat√≥rios!")
                
        except ValueError:
            print("‚ùå Ano deve ser um n√∫mero!")
        except Exception as e:
            print(f"‚ùå Erro ao cadastrar cliente: {e}")
        
        input("\nPressione Enter para continuar...")
    
    def buscar_cliente(self):
        """Busca cliente por nome"""
        nome = input("\nüîç Digite o nome do cliente: ").strip()
        
        if nome:
            clientes = self.sistema.db.buscar_clientes(nome=nome)
            
            if not clientes.empty:
                print(f"\nüë• Clientes encontrados:")
                print("-" * 50)
                for _, cliente in clientes.iterrows():
                    print(f"Nome: {cliente['nome']}")
                    print(f"Telefone: {cliente['telefone']}")
                    print(f"Carro: {cliente['marca_carro']} {cliente['modelo_carro']} ({cliente['ano_carro']})")
                    print("-" * 50)
            else:
                print("‚ùå Nenhum cliente encontrado!")
        
        input("\nPressione Enter para continuar...")
    
    def listar_clientes(self):
        """Lista todos os clientes"""
        clientes = self.sistema.db.buscar_clientes()
        
        if not clientes.empty:
            print(f"\nüë• TODOS OS CLIENTES ({len(clientes)} registros)")
            print("=" * 60)
            
            for _, cliente in clientes.iterrows():
                print(f"‚Ä¢ {cliente['nome']} - {cliente['telefone']}")
                print(f"  {cliente['marca_carro']} {cliente['modelo_carro']} ({cliente['ano_carro']})")
                print()
        else:
            print("‚ùå Nenhum cliente cadastrado!")
        
        input("\nPressione Enter para continuar...")
    
    def clientes_por_marca(self):
        """Lista clientes por marca de carro"""
        marca = input("\nüöó Digite a marca do carro: ").strip()
        
        if marca:
            clientes = self.sistema.buscar_clientes_por_marca(marca)
            
            if not clientes.empty:
                print(f"\nüë• Clientes com carros {marca}:")
                print("-" * 40)
                for _, cliente in clientes.iterrows():
                    print(f"‚Ä¢ {cliente['nome']} - {cliente['modelo_carro']} ({cliente['ano_carro']})")
            else:
                print(f"‚ùå Nenhum cliente com carro {marca} encontrado!")
        
        input("\nPressione Enter para continuar...")
    
    def menu_consultas(self):
        """Menu para consultas de pe√ßas"""
        while True:
            print("\nüîç CONSULTAS DE PE√áAS")
            print("="*22)
            print("1. Buscar por categoria")
            print("2. Buscar por fabricante")
            print("3. Buscar por nome/descri√ß√£o")
            print("4. Pe√ßas mais caras")
            print("5. Pe√ßas mais baratas")
            print("0. Voltar ao menu principal")
            
            opcao = input("\n‚û§ Escolha uma op√ß√£o: ").strip()
            
            if opcao == '1':
                self.buscar_por_categoria()
            elif opcao == '2':
                self.buscar_por_fabricante()
            elif opcao == '3':
                self.buscar_por_nome()
            elif opcao == '4':
                self.pecas_mais_caras()
            elif opcao == '5':
                self.pecas_mais_baratas()
            elif opcao == '0':
                break
            else:
                input("‚ùå Op√ß√£o inv√°lida! Pressione Enter para continuar...")
    
    def buscar_por_categoria(self):
        """Busca pe√ßas por categoria"""
        print("\nüì¶ CATEGORIAS DISPON√çVEIS:")
        print("‚Ä¢ Motor")
        print("‚Ä¢ Suspens√£o")
        print("‚Ä¢ Arrefecimento")
        print("‚Ä¢ Ar Condicionado")
        print("‚Ä¢ Inje√ß√£o Eletr√¥nica")
        print("‚Ä¢ Freios")
        print("‚Ä¢ El√©trica")
        print("‚Ä¢ Transmiss√£o")
        
        categoria = input("\nDigite a categoria: ").strip()
        
        if categoria:
            pecas = self.sistema.buscar_pecas_por_categoria(categoria)
            
            if not pecas.empty:
                print(f"\nüîß Pe√ßas da categoria '{categoria}':")
                print("=" * 50)
                
                for _, peca in pecas.head(10).iterrows():  # Mostrar apenas 10 primeiras
                    preco_str = f"R$ {peca['preco']:.2f}" if peca['preco'] > 0 else "Pre√ßo sob consulta"
                    print(f"‚Ä¢ {peca['nome']}")
                    print(f"  Fabricante: {peca['fabricante']} | Pre√ßo: {preco_str}")
                    print()
                
                if len(pecas) > 10:
                    print(f"... e mais {len(pecas) - 10} pe√ßas")
            else:
                print(f"‚ùå Nenhuma pe√ßa encontrada na categoria '{categoria}'!")
        
        input("\nPressione Enter para continuar...")
    
    def buscar_por_fabricante(self):
        """Busca pe√ßas por fabricante"""
        fabricante = input("\nüè≠ Digite o fabricante: ").strip()
        
        if fabricante:
            pecas = self.sistema.db.buscar_pecas(fabricante=fabricante)
            
            if not pecas.empty:
                print(f"\nüîß Pe√ßas do fabricante '{fabricante}':")
                print("=" * 50)
                
                for _, peca in pecas.head(10).iterrows():
                    preco_str = f"R$ {peca['preco']:.2f}" if peca['preco'] > 0 else "Sob consulta"
                    print(f"‚Ä¢ {peca['nome']} - {preco_str}")
                    print(f"  Categoria: {peca['categoria_nome']}")
                    print()
            else:
                print(f"‚ùå Nenhuma pe√ßa do fabricante '{fabricante}' encontrada!")
        
        input("\nPressione Enter para continuar...")
    
    def buscar_por_nome(self):
        """Busca pe√ßas por nome/descri√ß√£o"""
        nome_busca = input("\nüîç Digite o nome ou descri√ß√£o da pe√ßa: ").strip()
        
        if nome_busca:
            try:
                # Buscar no banco de dados
                conn = sqlite3.connect(self.sistema.db.db_name)
                
                query = '''
                    SELECT p.nome, c.nome as categoria, p.preco, p.fabricante, p.codigo_peca, p.aplicacao
                    FROM pecas p
                    LEFT JOIN categorias c ON p.categoria_id = c.id
                    WHERE p.nome LIKE ? OR p.descricao LIKE ? OR p.aplicacao LIKE ?
                    ORDER BY p.preco ASC
                '''
                
                termo_like = f'%{nome_busca}%'
                cursor = conn.cursor()
                cursor.execute(query, (termo_like, termo_like, termo_like))
                resultados = cursor.fetchall()
                conn.close()
                
                if resultados:
                    print(f"\nÔøΩ Encontradas {len(resultados)} pe√ßas:")
                    print("=" * 60)
                    
                    for resultado in resultados[:10]:  # Mostrar at√© 10 resultados
                        nome, categoria, preco, fabricante, codigo, aplicacao = resultado
                        preco_str = f"R$ {preco:.2f}" if preco > 0 else "Sob consulta"
                        
                        print(f"‚Ä¢ {nome}")
                        print(f"  Categoria: {categoria} | Pre√ßo: {preco_str}")
                        print(f"  Fabricante: {fabricante} | C√≥digo: {codigo}")
                        if aplicacao:
                            print(f"  Aplica√ß√£o: {aplicacao}")
                        print()
                    
                    if len(resultados) > 10:
                        print(f"... e mais {len(resultados) - 10} pe√ßas encontradas")
                else:
                    print(f"‚ùå Nenhuma pe√ßa encontrada com '{nome_busca}'")
                    
                    # Sugerir busca online
                    buscar_online = input("\nDeseja buscar online? (s/n): ").lower()
                    if buscar_online == 's':
                        print("üåê Buscando online...")
                        
                        # Buscar nas fontes online
                        pecas_online = self.sistema.scraper.extrair_pecas_autopecas(nome_busca, 5)
                        
                        if pecas_online:
                            print(f"\nüéØ Encontradas {len(pecas_online)} pe√ßas online:")
                            for peca in pecas_online:
                                print(f"  ‚Ä¢ {peca.nome} - R$ {peca.preco:.2f} ({peca.fabricante})")
                                if hasattr(peca, 'montadora') and peca.montadora != "N√£o especificado":
                                    print(f"    üöó Compat√≠vel: {peca.montadora} {peca.modelo_carro} ({peca.motor}) - {peca.anos_compativel}")
                                print()
                        else:
                            print("‚ùå Nenhuma pe√ßa encontrada online tamb√©m")
                            
            except Exception as e:
                print(f"‚ùå Erro na busca: {e}")
        
        input("\nPressione Enter para continuar...")
    
    def pecas_mais_caras(self):
        """Mostra as pe√ßas mais caras"""
        pecas_top = self.relatorios.pecas_mais_caras_por_categoria(3)
        
        if not pecas_top.empty:
            print("\nüíé PE√áAS MAIS CARAS POR CATEGORIA:")
            print("=" * 45)
            
            for categoria in pecas_top['categoria'].unique():
                print(f"\nüì¶ {categoria}:")
                categoria_pecas = pecas_top[pecas_top['categoria'] == categoria]
                
                for _, peca in categoria_pecas.iterrows():
                    print(f"  {peca['ranking']}¬∫ - {peca['peca_nome']}")
                    print(f"       R$ {peca['preco']:.2f} ({peca['fabricante']})")
        else:
            print("‚ùå Nenhuma pe√ßa com pre√ßo encontrada!")
        
        input("\nPressione Enter para continuar...")
    
    def pecas_mais_baratas(self):
        """Mostra as pe√ßas mais baratas"""
        try:
            conn = sqlite3.connect(self.sistema.db.db_name)
            
            query = '''
                SELECT 
                    c.nome as categoria,
                    p.nome as peca_nome,
                    p.preco,
                    p.fabricante,
                    ROW_NUMBER() OVER (PARTITION BY c.nome ORDER BY p.preco ASC) as ranking
                FROM pecas p
                LEFT JOIN categorias c ON p.categoria_id = c.id
                WHERE p.preco > 0
            '''
            
            cursor = conn.cursor()
            cursor.execute(query)
            resultados = cursor.fetchall()
            conn.close()
            
            if resultados:
                # Organizar por categoria
                categorias = {}
                for resultado in resultados:
                    categoria, peca_nome, preco, fabricante, ranking = resultado
                    if ranking <= 3:  # Top 3 mais baratas por categoria
                        if categoria not in categorias:
                            categorias[categoria] = []
                        categorias[categoria].append((peca_nome, preco, fabricante, ranking))
                
                print("\nüí∞ TOP 3 PE√áAS MAIS BARATAS POR CATEGORIA:")
                print("=" * 50)
                
                for categoria, pecas in categorias.items():
                    print(f"\nüì¶ {categoria}:")
                    for peca_nome, preco, fabricante, ranking in pecas:
                        print(f"  {ranking}¬∫ - {peca_nome}: R$ {preco:.2f} ({fabricante})")
            else:
                print("‚ùå Nenhuma pe√ßa com pre√ßo encontrada!")
                
        except Exception as e:
            print(f"‚ùå Erro ao buscar pe√ßas: {e}")
        
        input("\nPressione Enter para continuar...")
    
    def menu_relatorios(self):
        """Menu de relat√≥rios"""
        while True:
            print("\nüìä RELAT√ìRIOS E AN√ÅLISES")
            print("="*25)
            print("1. Estat√≠sticas gerais")
            print("2. Relat√≥rio de estoque")
            print("3. An√°lise de pre√ßos")
            print("4. Clientes por marca")
            print("5. Gerar dashboard HTML")
            print("0. Voltar ao menu principal")
            
            opcao = input("\n‚û§ Escolha uma op√ß√£o: ").strip()
            
            if opcao == '1':
                self.mostrar_estatisticas()
            elif opcao == '2':
                self.relatorio_estoque()
            elif opcao == '3':
                self.analise_precos()
            elif opcao == '4':
                self.relatorio_clientes_marca()
            elif opcao == '5':
                self.gerar_dashboard()
            elif opcao == '0':
                break
            else:
                input("‚ùå Op√ß√£o inv√°lida! Pressione Enter para continuar...")
    
    def mostrar_estatisticas(self):
        """Mostra estat√≠sticas gerais"""
        stats = self.relatorios.estatisticas_gerais()
        
        print("\nüìà ESTAT√çSTICAS GERAIS")
        print("=" * 22)
        print(f"üîß Total de pe√ßas: {stats.get('total_pecas', 0)}")
        print(f"üë• Total de clientes: {stats.get('total_clientes', 0)}")
        print(f"üì¶ Categorias ativas: {stats.get('categorias_ativas', 0)}")
        print(f"üí∞ Pre√ßo m√©dio: R$ {stats.get('preco_medio', 0):.2f}")
        
        if 'marca_mais_comum' in stats:
            print(f"üöó Marca mais comum: {stats['marca_mais_comum']} ({stats['clientes_marca_comum']} clientes)")
        
        input("\nPressione Enter para continuar...")
    
    def relatorio_estoque(self):
        """Mostra relat√≥rio de estoque"""
        relatorio = self.sistema.relatorio_estoque()
        
        if not relatorio.empty:
            print("\nüìä RELAT√ìRIO DE ESTOQUE")
            print("=" * 25)
            
            for _, row in relatorio.iterrows():
                print(f"\nüì¶ {row['categoria']}:")
                print(f"   Quantidade: {row['quantidade_pecas']} pe√ßas")
                print(f"   Pre√ßo m√©dio: R$ {row['preco_medio']:.2f}")
                print(f"   Faixa: R$ {row['menor_preco']:.2f} - R$ {row['maior_preco']:.2f}")
        else:
            print("‚ùå Nenhum dado de estoque dispon√≠vel!")
        
        input("\nPressione Enter para continuar...")
    
    def analise_precos(self):
        """An√°lise de pre√ßos por categoria"""
        print("\nüí∞ Gerando an√°lise de pre√ßos...")
        df_precos = self.relatorios.analise_precos_por_categoria()
        
        if not df_precos.empty:
            print("‚úÖ Gr√°fico salvo como 'precos_por_categoria.png'")
            
            # Mostrar resumo estat√≠stico
            resumo = df_precos.groupby('categoria')['preco'].agg(['count', 'mean', 'std', 'min', 'max'])
            print("\nüìä Resumo estat√≠stico:")
            print(resumo.round(2))
        else:
            print("‚ùå Nenhum dado de pre√ßo dispon√≠vel!")
        
        input("\nPressione Enter para continuar...")
    
    def relatorio_clientes_marca(self):
        """Relat√≥rio de clientes por marca"""
        relatorio = self.relatorios.relatorio_clientes_por_marca()
        
        if not relatorio.empty:
            print("\nüöó CLIENTES POR MARCA DE CARRO")
            print("=" * 32)
            
            for _, row in relatorio.iterrows():
                print(f"\n‚Ä¢ {row['marca_carro']}:")
                print(f"   Clientes: {row['total_clientes']}")
                print(f"   Ano m√©dio: {row['ano_medio']:.0f}")
                print(f"   Faixa de anos: {row['ano_mais_antigo']} - {row['ano_mais_novo']}")
        else:
            print("‚ùå Nenhum cliente cadastrado!")
        
        input("\nPressione Enter para continuar...")
    
    def gerar_dashboard(self):
        """Gera dashboard HTML"""
        print("\nüé® Gerando dashboard HTML...")
        
        try:
            self.relatorios.gerar_dashboard_html("dashboard.html")
            print("‚úÖ Dashboard gerado com sucesso!")
            print("üìÅ Arquivo salvo como: dashboard.html")
            
            # Tentar abrir o arquivo
            abrir = input("\nDeseja abrir o dashboard no navegador? (s/n): ").lower()
            if abrir == 's':
                import webbrowser
                webbrowser.open("dashboard.html")
                
        except Exception as e:
            print(f"‚ùå Erro ao gerar dashboard: {e}")
        
        input("\nPressione Enter para continuar...")
    
    def menu_importacao(self):
        """Menu de importa√ß√£o/exporta√ß√£o"""
        while True:
            print("\nüì• IMPORTAR/EXPORTAR DADOS")
            print("="*27)
            print("1. Criar templates CSV")
            print("2. Importar pe√ßas de CSV")
            print("3. Importar clientes de CSV")
            print("4. Exportar pe√ßas para CSV")
            print("5. Exportar clientes para CSV")
            print("0. Voltar ao menu principal")
            
            opcao = input("\n‚û§ Escolha uma op√ß√£o: ").strip()
            
            if opcao == '1':
                self.criar_templates()
            elif opcao == '2':
                self.importar_pecas()
            elif opcao == '3':
                self.importar_clientes()
            elif opcao == '4':
                self.exportar_pecas()
            elif opcao == '5':
                self.exportar_clientes()
            elif opcao == '0':
                break
            else:
                input("‚ùå Op√ß√£o inv√°lida! Pressione Enter para continuar...")
    
    def criar_templates(self):
        """Cria templates CSV"""
        print("\nüìÑ Criando templates CSV...")
        self.importador.criar_templates_csv()
        input("\nPressione Enter para continuar...")
    
    def importar_pecas(self):
        """Importa pe√ßas de CSV"""
        arquivo = input("\nüìÅ Nome do arquivo CSV de pe√ßas: ").strip()
        
        if arquivo and os.path.exists(arquivo):
            print(f"üì• Importando pe√ßas de {arquivo}...")
            pecas_importadas = self.importador.importar_pecas_csv(arquivo)
            print(f"‚úÖ {pecas_importadas} pe√ßas importadas com sucesso!")
        else:
            print("‚ùå Arquivo n√£o encontrado!")
        
        input("\nPressione Enter para continuar...")
    
    def importar_clientes(self):
        """Importa clientes de CSV"""
        arquivo = input("\nüìÅ Nome do arquivo CSV de clientes: ").strip()
        
        if arquivo and os.path.exists(arquivo):
            print(f"üì• Importando clientes de {arquivo}...")
            clientes_importados = self.importador.importar_clientes_csv(arquivo)
            print(f"‚úÖ {clientes_importados} clientes importados com sucesso!")
        else:
            print("‚ùå Arquivo n√£o encontrado!")
        
        input("\nPressione Enter para continuar...")
    
    def exportar_pecas(self):
        """Exporta pe√ßas para CSV"""
        arquivo = input("\nüìÅ Nome do arquivo de sa√≠da (ex: pecas.csv): ").strip()
        if not arquivo:
            arquivo = "pecas_export.csv"
        
        print(f"üì§ Exportando pe√ßas para {arquivo}...")
        total = self.importador.exportar_pecas_csv(arquivo)
        print(f"‚úÖ {total} pe√ßas exportadas com sucesso!")
        
        input("\nPressione Enter para continuar...")
    
    def exportar_clientes(self):
        """Exporta clientes para CSV"""
        arquivo = input("\nüìÅ Nome do arquivo de sa√≠da (ex: clientes.csv): ").strip()
        if not arquivo:
            arquivo = "clientes_export.csv"
        
        print(f"üì§ Exportando clientes para {arquivo}...")
        total = self.importador.exportar_clientes_csv(arquivo)
        print(f"‚úÖ {total} clientes exportados com sucesso!")
        
        input("\nPressione Enter para continuar...")
    
    def menu_configuracoes(self):
        """Menu de configura√ß√µes"""
        print("\n‚öôÔ∏è  CONFIGURA√á√ïES")
        print("="*15)
        print("1. Verificar depend√™ncias")
        print("2. Limpar cache")
        print("3. Backup do banco de dados")
        print("4. Restaurar banco de dados")
        print("0. Voltar ao menu principal")
        
        opcao = input("\n‚û§ Escolha uma op√ß√£o: ").strip()
        
        if opcao == '1':
            self.verificar_dependencias()
        elif opcao == '2':
            print("üßπ Limpando cache...")
            print("‚úÖ Cache limpo!")
        elif opcao == '3':
            self.fazer_backup()
        elif opcao == '4':
            self.restaurar_backup()
        
        input("\nPressione Enter para continuar...")
    
    def verificar_dependencias(self):
        """Verifica se todas as depend√™ncias est√£o instaladas"""
        print("\nüîç Verificando depend√™ncias...")
        
        dependencias = [
            'requests', 'beautifulsoup4', 'pandas', 'sqlite3',
            'matplotlib', 'seaborn', 'plotly'
        ]
        
        for dep in dependencias:
            try:
                __import__(dep)
                print(f"‚úÖ {dep}")
            except ImportError:
                print(f"‚ùå {dep} - N√ÉO INSTALADO")
        
        input("\nPressione Enter para continuar...")
    
    def fazer_backup(self):
        """Faz backup do banco de dados"""
        import shutil
        from datetime import datetime
        
        timestamp = datetime.now().strftime("%Y%m%d_%H%M%S")
        backup_name = f"backup_automotivas_{timestamp}.db"
        
        try:
            shutil.copy2("automotivas.db", backup_name)
            print(f"‚úÖ Backup criado: {backup_name}")
        except Exception as e:
            print(f"‚ùå Erro ao criar backup: {e}")
        
        input("\nPressione Enter para continuar...")
    
    def restaurar_backup(self):
        """Restaura backup do banco de dados"""
        import glob
        
        # Listar backups dispon√≠veis
        backups = glob.glob("backup_automotivas_*.db")
        
        if not backups:
            print("‚ùå Nenhum backup encontrado!")
            input("\nPressione Enter para continuar...")
            return
        
        print("\nüìÅ Backups dispon√≠veis:")
        for i, backup in enumerate(backups, 1):
            print(f"{i}. {backup}")
        
        try:
            escolha = int(input("\nEscolha o backup para restaurar (n√∫mero): ").strip())
            
            if 1 <= escolha <= len(backups):
                backup_escolhido = backups[escolha - 1]
                
                # Confirmar restaura√ß√£o
                confirmacao = input(f"\n‚ö†Ô∏è  Confirma restaurar '{backup_escolhido}'? (s/n): ").lower()
                
                if confirmacao == 's':
                    # Fazer backup do atual antes de restaurar
                    from datetime import datetime
                    timestamp = datetime.now().strftime("%Y%m%d_%H%M%S")
                    backup_atual = f"backup_antes_restauracao_{timestamp}.db"
                    
                    shutil.copy2("automotivas.db", backup_atual)
                    print(f"üîÑ Backup atual salvo como: {backup_atual}")
                    
                    # Restaurar o backup escolhido
                    shutil.copy2(backup_escolhido, "automotivas.db")
                    print(f"‚úÖ Banco restaurado com sucesso!")
                    print("‚ö†Ô∏è  Reinicie o sistema para aplicar as mudan√ßas.")
                else:
                    print("‚ùå Restaura√ß√£o cancelada!")
            else:
                print("‚ùå Op√ß√£o inv√°lida!")
                
        except ValueError:
            print("‚ùå Digite um n√∫mero v√°lido!")
        except Exception as e:
            print(f"‚ùå Erro ao restaurar backup: {e}")
        
        input("\nPressione Enter para continuar...")

def main():
    """Fun√ß√£o principal"""
    try:
        menu = MenuPrincipal()
        menu.menu_principal()
    except KeyboardInterrupt:
        print("\n\nüëã Sistema finalizado pelo usu√°rio!")
    except Exception as e:
        print(f"\n‚ùå Erro inesperado: {e}")
        print("Por favor, relate este erro ao desenvolvedor.")

if __name__ == "__main__":
    main()
